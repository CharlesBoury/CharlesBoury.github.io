

<!DOCTYPE html>
<meta charset="utf-8">
<link rel="shortcut icon" href="../Images/favicon.png"/>
<title>Charles Boury | Myriad</title>

<link rel="stylesheet" href="../css/retour.css"/>
<link rel="stylesheet" href="../css/sliders.css"/>

<script src="scripts/Sliders.js"></script>
<script src="scripts/Vecteur.js"></script>
<script src="scripts/LoopEtSouris.js"></script>
<script src="scripts/DialogueAvecCSS.js"></script>
<script src="scripts/Random.js"></script>



<style type="text/css">
	
	html, body {
		width: 100%;
		height: 100%;
		margin: 0;
		background-color: #38231b;
		cursor:url(Images/Curseur.png) 7 1, auto;

		/* pour ne pas avoir de scroll
		 quand les particules sortent de l'écran */
		overflow: hidden;

		background: url(Images/Fond.png) no-repeat center center fixed; 
		-webkit-background-size: cover;
		-moz-background-size: cover;
		-o-background-size: cover;
		background-size: cover;
	}

	#WIP {
		position: absolute;
		right: 5px;
		bottom: 0px;
		margin: 20px;

		font-family: sans-serif;
		color: #b56c18;
	}

	.particule {
		display: block;
		position: absolute;
		margin-top: -11px;
		margin-left: -10px;
		z-index: 3;
	}

	#MouseFearZone, #NestZone {
		position: absolute;
		margin-top: -150px;
		margin-left: -150px;
		z-index: 1;
	}

	#NestZone {
		opacity: 0.25;

	}

	#Options {
		position: relative;
		padding: 6px;
		margin: 50px 0 0px 25px;
		width: 100px; /* pour reduire la zone de clic */
		z-index: 10;

		font-size: 14px;
		color: #b56c18;
		font-family: monospace;
	}

	#Options:hover {
		color: #F99522;
	}

	#Tableau {
		/* au dessus de la page */
		position: relative;
		margin-left: 30px;
		z-index: 10;
	}

	input[type="range"] {
		cursor:url(Images/Curseur.png) 7 1, auto;
	}

	.unselectable {
		-webkit-user-select: none;  /* Chrome all / Safari all */
		-moz-user-select: none;     /* Firefox all */
		-ms-user-select: none;      /* IE 10+ */
		user-select: none;          /* Likely future */       
	}


</style>

<body>

	<p id="WIP">Work In Progress</p>

	<p id="Options" class="unselectable" onclick="toggleTableau()">Options &blacktriangledown;</p>

	<div id="Tableau" style="display: block;">
	<!-- /////////////////// -->
		<div class="label">Particules</div>
	<!-- /////////////////// -->
		<div class="param">
			<input id="nombre" type="range"
				value="20"
				min="0" max="60"
				step="1">
			<span class="nom">nom</span>
			<span class="valeur"></span>
		</div>
	<!-- /////////////////// -->
		<div class="param">
			<input id="vitesse" type="range"
				value="0.9"
				min="0" max="1"
				step="0.01">
			<span class="nom">nom</span>
			<span class="valeur"></span>
		</div>
	<!-- /////////////////// -->
		<div class="param">
			<input id="distanceEntreElles" type="range"
				value="20"
				min="0" max="50"
				step="1">
			<span class="nom">nom</span>
			<span class="valeur"></span>
		</div>
	<!-- /////////////////// -->
		<div class="espace"></div>
		<div class="label">Souris</div>
	<!-- /////////////////// -->
		<div class="param">
			<input id="tailleSouris" type="range"
				value="200"
				min="0" max="300"
				step="1">
			<span class="nom">nom</span>
			<span class="valeur"></span>
		</div>
	<!-- /////////////////// -->
		<div class="param">
			<input id="forceDeRepulsion" type="range"
				value="0.3"
				min="0" max="2"
				step="0.01">
			<span class="nom">nom</span>
			<span class="valeur"></span>
		</div>
	<!-- /////////////////// -->
		<div class="espace"></div>
		<div class="label">Nid</div>
	<!-- /////////////////// -->
		<div class="param">
			<input id="tailleNid" type="range"
				value="70"
				min="0" max="1000"
				step="1">
			<span class="nom">nom</span>
			<span class="valeur"></span>
		</div>
	<!-- /////////////////// -->
		<div class="param">
			<input id="forceDattraction" type="range"
				value="0.01"
				min="0" max="0.5"
				step="0.005">
			<span class="nom">nom</span>
			<span class="valeur"></span>
		</div>
	<!-- /////////////////// -->
	</div>




	<div id="Factory" style="display:none;">
		<!-- Un modele de particule, parfait en tous points. A copier allegrement -->
		<img class="particule" data-vel-x="0" data-vel-y="0" src="Images/Particule.png"">
	</div>



	<div id="BattleField" class="unselectable">
		<img class="particule" data-vel-x="0" data-vel-y="0" src="Images/Particule.png">
		<img class="particule" data-vel-x="0" data-vel-y="0" src="Images/Particule.png">
	</div>

	<img id="MouseFearZone" class="unselectable" src="Images/Cercle300.png">
	<img id="NestZone"  class="unselectable" src="Images/Rond300.png">



	<a id="Retour" href="../index.html"></a>














<script type="text/javascript">


// le nid des particules est au centre de la fenetre
var fenetre = new Point (document.body.clientWidth, document.body.clientHeight)
var nid = multPar(fenetre, 1/2)


var particules = document.getElementById('BattleField').getElementsByClassName('particule')

var nombre           = getSliderValue('nombre')
var vitesse          = getSliderValue('vitesse')
var distanceEntreElles   = getSliderValue('distanceEntreElles')

var tailleSouris     = getSliderValue('tailleSouris')
var forceDeRepulsion = getSliderValue('forceDeRepulsion')

var tailleNid        = getSliderValue('tailleNid')
var forceDattraction = getSliderValue('forceDattraction')

var rotationMouseFearZone = 0;









function start() {
	initSliders()

	// creation de plein de particules
	for(var i = 0; i < 0; i++) {
		creerParticule();
	}

	// disposition aléatoire des particules
	for(var i = 0; i < particules.length; i++) {
		setCSSposition(particules[i], pointAleatoireDansRect(fenetre)) }

}


function update() {



	// recuperation des valeurs des sliders
	nombre           = getSliderValue('nombre')
	vitesse          = getSliderValue('vitesse')
	distanceEntreElles   = getSliderValue('distanceEntreElles')

	tailleSouris     = getSliderValue('tailleSouris')
	forceDeRepulsion = getSliderValue('forceDeRepulsion')
	tailleNid        = getSliderValue('tailleNid')
	forceDattraction = getSliderValue('forceDattraction')


	var dif = (nombre - particules.length)
	if (dif != 0) {
		if (dif > 0) { creerParticules(dif) }
		else         { supprimerParticule(-dif) }
	}





	// dessin de la zone de peur de la souris
	if (estNul(window.souris)) {
		document.getElementById('MouseFearZone').style.display = 'none'
	} else {
		document.getElementById('MouseFearZone').style.display = 'initial'
	}
	setCSSposition(document.getElementById('MouseFearZone'), window.souris)
	rotationMouseFearZone +=5;
	document.getElementById('MouseFearZone').style.transform = 'scale('+tailleSouris/150+') rotate('+ rotationMouseFearZone +'deg)'

	// dessin du nid
	setCSSposition(document.getElementById('NestZone'), nid)
	document.getElementById('NestZone').style.transform = 'Scale('+tailleNid/150+')'


	for(var i = 0; i < particules.length; i++) {

		// recuperation de la position
		var pos = getCSSposition(particules[i])

		//calcul de la force qu'exerce la souris
		var forceSouris = new Point(0,0);
		if (distance(pos, window.souris) < tailleSouris) {
			var trajetVersSouris = trajet(pos, window.souris)
			// force necessaire pour sortir le plus vite possible du cercle de peur
			forceSouris = invert( setMag(trajetVersSouris, tailleSouris - mag(trajetVersSouris)) )
			forceSouris = multPar(forceSouris, forceDeRepulsion)
		}

		// calcule de la force qu'exerce le nid
		var forceNid = new Point(0,0);
		if (distance(pos, nid) > tailleNid) {
			// si on est à l'exterieur du nid
			forceNid = multPar(trajet(pos, nid), forceDattraction)
		}

		// recuperation de la velocite et ajout des forces
		var vel = new Point(
			parseFloat(particules[i].dataset.velX),
			parseFloat(particules[i].dataset.velY) )

		vel = add(vel, forceNid)

		vel = add(vel, forceSouris)
		// ralentissemt par frottements
		vel = multPar(vel, vitesse)




		// test de collisions suivant la nouvelle position
		// Ce sont les autres qui se poussent, c'est plus simple
		var newPos = add(pos, vel)
		for(var j = 0; j < particules.length; j++) {
			// on ne teste pas la collision avec soi-meme
			if (i != j) {
				var posDeLautre = getCSSposition(particules[j])
				if (distance (newPos, posDeLautre) < distanceEntreElles) {
					var newPosDeLautre = add(newPos, setMag(trajet(newPos, posDeLautre),distanceEntreElles))
					// tout le monde se pousse c'est drôle !
					setCSSposition(particules[j], newPosDeLautre)
				}
			}
		}

		// sauvegarde de la velocite
		particules[i].dataset.velX = vel.x
		particules[i].dataset.velY = vel.y

		// nouvelle position
		setCSSposition(particules[i], newPos)

		// nouvelle rotation
		if (!estNul(vel)) {
			// on ne reset pas la rotation si la particule arrete de bouger
			// (on garde celle d'avant, jusqu'au prochain mouvement)
			setCSSrotation(particules[i], vel)
		}
	}

}



function creerParticule() {
	var proto = document.getElementById('Factory').getElementsByClassName('particule')[0];
	var clone = proto.cloneNode(true);
	// il faut lui set une position sinon elle est inerte
	setCSSposition(clone,pointAleatoireDansRect(fenetre))
	document.getElementById('BattleField').appendChild(clone);
}

function supprimerParticule() {
	var battleField = document.getElementById('BattleField')
	var premiereParticule = battleField.getElementsByClassName('particule')[0]

	if (premiereParticule) {
		battleField.removeChild(premiereParticule)
	}
}

function creerParticules(nFois) {
	for (var i = 0; i < nFois; i++) { creerParticule() }
}

function supprParticules(nFois) {
	for (var i = 0; i < nFois; i++) { supprimerParticule() }
}

function toggleTableau() {
	console.log('toggle')
	var tableau = document.getElementById('Tableau')
	if (tableau.style.display == "none") {
		tableau.style.display = "block";
	} else {
		tableau.style.display = 'none';
	}
}


</script>




